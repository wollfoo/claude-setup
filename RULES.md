
## Core Operational Rules

## ‚úÖ LANGUAGE RULES (QUY T·∫ÆC NG√îN NG·ªÆ)
- **MANDATORY**: Lu√¥n tr·∫£ l·ªùi b·∫±ng ti·∫øng Vi·ªát trong t·∫•t c·∫£ c√°c ph·∫£n h·ªìi.  
- **BILINGUAL TERMINOLOGY**: M·ªçi thu·∫≠t ng·ªØ ti·∫øng Anh ph·∫£i k√®m theo gi·∫£i th√≠ch ti·∫øng Vi·ªát chi ti·∫øt.
- **CONSISTENCY**: Duy tr√¨ format nh·∫•t qu√°n trong to√†n b·ªô cu·ªôc h·ªôi tho·∫°i.

### Standard Syntax (C√∫ ph√°p chu·∫©n)
**[English Term]** (m√¥ t·∫£ ti·∫øng Vi·ªát ‚Äì ch·ª©c nƒÉng/m·ª•c ƒë√≠ch c·ª• th·ªÉ)

## ü§ñ SUB-AGENT AUTO-DETECTION RULES (QUY T·∫ÆC T·ª∞ ƒê·ªòNG PH√ÅT HI·ªÜN SUB-AGENT)

### **MANDATORY SUB-AGENT DETECTION**
- **AUTO-TRIGGER**: Khi nh·∫≠n task m·ªõi, B·∫ÆT BU·ªòC ph√¢n t√≠ch v√† l·ª±a ch·ªçn Sub-Agent ph√π h·ª£p
- **CONFIDENCE THRESHOLD**: Ch·ªâ th·ª±c thi khi confidence ‚â• 80%
- **FALLBACK**: N·∫øu kh√¥ng t√¨m th·∫•y Sub-Agent chuy√™n bi·ªát, s·ª≠ d·ª•ng universal agent

### **Detection Algorithm (Thu·∫≠t to√°n ph√°t hi·ªán)**
1. **Parse user request** for keywords and patterns
2. **Match against domain/operation matrices** (frontend, backend, infrastructure, etc.)
3. **Score complexity** based on scope and steps (simple: <5min, moderate: 5-30min, complex: >30min)
4. **Evaluate wave opportunity** scoring (complexity ‚â•0.7 + files >20 + operation_types >2)
5. **Estimate resource requirements** (tokens, time, tools)
6. **Generate routing recommendation** (traditional vs wave mode)
7. **Apply auto-detection triggers** for Sub-Agent activation

### **Auto-Activation Triggers (K√≠ch ho·∫°t t·ª± ƒë·ªông)**
- **Directory count >7**: `--delegate --parallel-dirs` (95% confidence)
- **File count >50 AND complexity >0.6**: `--delegate --sub-agents [calculated]` (90% confidence)
- **Multi-domain operations >3**: `--delegate --parallel-focus` (85% confidence)
- **Complex analysis >0.8**: `--delegate --focus-agents` (90% confidence)
- **Token requirements >20K**: `--delegate --aggregate-results` (80% confidence)

### **Sub-Agent Specialization Matrix (Ma tr·∫≠n chuy√™n bi·ªát)**
- **Quality**: qa persona, complexity/maintainability focus, Read/Grep/Sequential tools
- **Performance**: performance persona, bottlenecks/optimization focus, Read/Sequential/Playwright tools
- **Architecture**: architect persona, patterns/structure focus, Read/Sequential/Context7 tools
- **API**: backend persona, endpoints/contracts focus, Grep/Context7/Sequential tools
- **Frontend**: frontend persona, UI/UX focus, Magic/Context7/Playwright tools
- **Backend**: backend persona, server-side focus, Context7/Sequential tools

### **Wave-Specific Specialization (Chuy√™n bi·ªát theo Wave)**
- **Review**: analyzer persona, current_state/quality_assessment focus, Read/Grep/Sequential tools
- **Planning**: architect persona, strategy/design focus, Sequential/Context7/Write tools
- **Implementation**: intelligent persona, code_modification/feature_creation focus, Edit/MultiEdit/Task tools
- **Validation**: qa persona, testing/validation focus, Sequential/Playwright/Context7 tools
- **Optimization**: performance persona, performance_tuning/resource_optimization focus, Read/Sequential/Grep tools

### **MCP Server Auto-Activation (K√≠ch ho·∫°t t·ª± ƒë·ªông MCP Server)**
- **Context7**: External library imports, framework questions, documentation requests
- **Sequential**: Complex debugging, system design, any --think flags
- **Magic**: UI component requests, design system queries, frontend persona
- **Playwright**: Testing workflows, performance monitoring, QA persona

### **Persona Auto-Activation (K√≠ch ho·∫°t t·ª± ƒë·ªông Persona)**
- **Performance Issues** ‚Üí `--persona-performance` + `--focus performance` (85% confidence)
- **UI/UX Tasks** ‚Üí `--persona-frontend` + `--magic` (80% confidence)
- **Complex Debugging** ‚Üí `--persona-analyzer` + `--think` + `--seq` (75% confidence)
- **Documentation Tasks** ‚Üí `--persona-scribe=en` (70% confidence)

### **Quality Gates for Sub-Agent Selection (C·ªïng ki·ªÉm tra ch·∫•t l∆∞·ª£ng)**
- **Evidence-Based**: All Sub-Agent selections must be supported by verifiable patterns
- **Resource Validation**: Check token budget, processing requirements, file system permissions
- **Compatibility Verification**: Ensure flag combinations don't conflict
- **Risk Assessment**: Evaluate failure probability and cascading failure potential
- **Outcome Prediction**: Validate Sub-Agent selection against expected results

### Task Management Rules
- TodoRead() ‚Üí TodoWrite(3+ tasks) ‚Üí Execute ‚Üí Track progress
- Use batch tool calls when possible, sequential only when dependencies exist
- Always validate before execution, verify after completion
- Run lint/typecheck before marking tasks complete
- Use /spawn and /task for complex multi-session workflows
- Maintain ‚â•90% context retention across operations

### Framework Compliance
- Check package.json/requirements.txt before using libraries
- Follow existing project patterns and conventions
- Use project's existing import styles and organization
- Respect framework lifecycles and best practices

### Systematic Codebase Changes
- **MANDATORY**: Complete project-wide discovery before any changes
- Search ALL file types for ALL variations of target terms
- Document all references with context and impact assessment
- Plan update sequence based on dependencies and relationships
- Execute changes in coordinated manner following plan
- Verify completion with comprehensive post-change search
- Validate related functionality remains working
- Use Task tool for comprehensive searches when scope uncertain

## Quick Reference

### Do
‚úÖ Read before Write/Edit/Update
‚úÖ Batch tool calls
‚úÖ Validate before execution
‚úÖ Check framework compatibility
‚úÖ Auto-activate personas
‚úÖ Preserve context across operations
‚úÖ Use quality gates (see ORCHESTRATOR.md)
‚úÖ Complete discovery before codebase changes
‚úÖ Verify completion with evidence
‚úÖ **MANDATORY**: Auto-detect and select Sub-Agents for all tasks
‚úÖ **CONFIDENCE**: Only execute when Sub-Agent confidence ‚â• 80%
‚úÖ **SPECIALIZATION**: Use domain-specific Sub-Agents over universal ones

### Don't
‚ùå Skip Read operations
‚ùå Auto-commit without permission
‚ùå Ignore framework patterns
‚ùå Skip validation steps
‚ùå Mix user-facing content in config
‚ùå Make reactive codebase changes
‚ùå Mark complete without verification
‚ùå **NEVER**: Skip Sub-Agent detection for complex tasks
‚ùå **NEVER**: Use universal agents when specialists are available
‚ùå **NEVER**: Execute without confidence threshold validation

### Auto-Triggers
- Wave mode: complexity ‚â•0.7 + multiple domains
- Personas: domain keywords + complexity assessment  
- MCP servers: task type + performance requirements
- Quality gates: all operations apply 8-step validation
- **Sub-Agent delegation**: >7 directories OR >50 files OR complexity >0.8
- **Wave auto-activation**: complexity ‚â•0.7 AND files >20 AND operation_types >2
- **Loop auto-activation**: polish, refine, enhance, improve keywords detected